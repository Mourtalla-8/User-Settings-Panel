<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>User Settings Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            background-image:
                    linear-gradient(to bottom right, #ffffff, transparent 188%),
                    linear-gradient(to bottom, #115ba7 -51%, #0857a9 44%, transparent 69%),
                    radial-gradient(at center right, #db4879, transparent 53%),
                    radial-gradient(at bottom left, #b3754a, transparent 78%),
                    radial-gradient(at bottom right, #ffffff, transparent 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }

        /* sidebar */
        .sidebar li.active,
        .sidebar li:hover {
            background-color: #ededed !important;
        }

        .sidebar li.active {
            border: 1px solid #e0e0e0;
        }

        .icon {
            width: 45% !important;
            opacity: .7;
            transition: all 0.3s ease;
        }

        .sidebar li:hover .icon, .sidebar li.active .icon {
            opacity: .8 !important;
            width: 57% !important;
        }

        .iconG {
            width: 33px !important;
            opacity: .7;
            transition: all 0.3s ease;
        }

        .sidebar li:hover .iconG, .sidebar li.active .iconG {
            opacity: .8 !important;
            width: 38px !important;
        }



        /*toggles*/
        .switch {
            --button-width: 2.8em;
            --button-height: 1.5em;
            --toggle-diameter: 1.2em;
            --button-toggle-offset: calc((var(--button-height) - var(--toggle-diameter)) / 2);
            --toggle-shadow-offset: 10px;
            --toggle-wider: 3em;
            --color-grey: #cccccc;
            --color-green: #595959;
        }

        .slider {
            display: inline-block;
            width: var(--button-width);
            height: var(--button-height);
            background-color: var(--color-grey);
            border-radius: calc(var(--button-height) / 2);
            position: relative;
            transition: 0.3s all ease-in-out;
            cursor: pointer;
        }

        .slider::after {
            content: "";
            display: inline-block;
            width: var(--toggle-diameter);
            height: var(--toggle-diameter);
            background-color: #fff;
            border-radius: 50%;
            position: absolute;
            top: var(--button-toggle-offset);
            transform: translateX(var(--button-toggle-offset));
            box-shadow: var(--toggle-shadow-offset) 0 calc(var(--toggle-shadow-offset) * 4) rgba(0, 0, 0, 0.1);
            transition: 0.3s all ease-in-out;
        }

        .switch input[type="checkbox"]:checked + .slider {
            background-color: var(--color-green);
        }

        .switch input[type="checkbox"]:checked + .slider::after {
            transform: translateX(calc(var(--button-width) - var(--toggle-diameter) - var(--button-toggle-offset)));
            box-shadow: calc(var(--toggle-shadow-offset) * -1) 0 calc(var(--toggle-shadow-offset) * 4) rgba(0, 0, 0, 0.1);
        }

        .switch input[type="checkbox"] {
            display: none;
        }

        .switch input[type="checkbox"]:active + .slider::after {
            width: var(--toggle-wider);
        }

        .switch input[type="checkbox"]:checked:active + .slider::after {
            transform: translateX(calc(var(--button-width) - var(--toggle-wider) - var(--button-toggle-offset)));
        }


        /* custom select */
        .custom-select {
            width: 160px;
        }

        .custom-select select {
            appearance: none;
            width: 100%;
            padding: 13px;
            border: none;
            background-color: #ededed;
            cursor: pointer;
        }

        .custom-select select:focus {
            outline: none;
        }

        .custom-select::after {
            content: "›";
            position: absolute;
            top: 50%;
            right: 18px;
            transform: translateY(-50%) rotate(90deg);
            pointer-events: none;
            color: #333;
        }

        .edit-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            position: relative;
        }

        .edit-btn img {
            width: 17px;
            height: 17px;
            position: absolute;
            bottom: -7px;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.sidebar li')
            const mainContent = document.querySelector('main')
            const originalMainHTML = mainContent.innerHTML

            /**
             * modification du username
             */
            function setupUsernameEdit() {
                const usernameContainer = document.querySelector('main .username')
                if (!usernameContainer) return // plus sûr

                const editBtn = usernameContainer.querySelector('.edit-btn')
                const usernameSpan = usernameContainer.querySelector('span')

                editBtn.addEventListener('click', () => {
                    // ne pas dupliquer l'input si déjà en édition
                    if (usernameContainer.querySelector('input')) return

                    // creer un input texte avec la valeur du useranme actuel
                    const input = document.createElement('input')
                    input.type = 'text'
                    input.value = usernameSpan.textContent.trim()
                    input.className = 'form-control me-2'
                    input.id = "username_input"
                    // input.style.minWidth = '150px'

                    const usernameLabel = document.querySelector('.username_label')
                    usernameLabel.setAttribute('for', 'username_input')

                    // créer un bouton Save
                    const saveBtn = document.createElement('button')
                    saveBtn.textContent = 'Save'
                    saveBtn.className = 'btn btn-primary px-3'

                    // remplacer le span + bouton edit par input + save
                    usernameSpan.style.display = 'none'
                    editBtn.style.display = 'none'

                    const container = usernameContainer.querySelector('div.d-flex.align-items-center')
                    container.appendChild(input)
                    container.appendChild(saveBtn)


                    saveBtn.addEventListener('click', () => {
                        const newValue = input.value.trim()
                        const minLength = 3
                        const maxLength = 16
                        const forbiddenCharsRegex = /[^a-zA-Z0-9_-]/ // lettres, chiffres, ., _, -

                        if (newValue.length < minLength || newValue.length > maxLength) {
                            alert(`Le nom d'utilisateur doit contenir entre ${minLength} et ${maxLength} caractères`)
                            return;
                        }

                        if (/\s/.test(newValue)) {
                            alert("Le nom d'utilisateur ne doit pas contenir d'espaces");
                            return;
                        }

                        if (forbiddenCharsRegex.test(newValue)) {
                            alert("caractères interdits. Seuls lettres, chiffres, tirets (-) et underscores (_) sont autorisés")
                            return;
                        }

                        // si tout est bon, on met à jour le username
                        usernameSpan.textContent = newValue;
                        localStorage.setItem('username', newValue) // sauvegarde du username

                        input.remove()
                        saveBtn.remove()
                        usernameSpan.style.display = ''
                        editBtn.style.display = ''
                    })

                    input.focus()

                    // touche "Enter" pour sauvegarder
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') saveBtn.click()
                    })
                })
            }

            /**
             * charger une page HTML depuis une URL et l'inserer dans le DOM
             * @param {string} url - l'URL du fichier HTML à charger
             * @returns {Promise<void>}
             */
            const loadHTML = async (url) => {
                try {
                    const response = await fetch(url)
                    if (!response.ok) throw new Error(`HTTP error ${response.status}`)
                    const html = await response.text()

                    mainContent.innerHTML = html

                } catch (error) {
                    mainContent.classList.add('d-flex', 'justify-content-center', 'align-items-center')
                    mainContent.innerHTML = `
                        <div class="text-center">
                            Erreur de chargement depuis <code>${url}</code><br>
                            ${error.message}
                        </div>
                    `
                    console.error('Erreur chargement :', error)
                }
            }

            // gestion de la navigation dans la sidebar
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    navItems.forEach(li => li.classList.remove('active'))
                    item.classList.add('active')

                    const label = item.querySelector('span')?.textContent?.trim() || ''

                    if (label === 'General') {
                        mainContent.classList.remove('d-flex', 'justify-content-center', 'align-items-center')
                        mainContent.innerHTML = originalMainHTML

                        // restaurer le username depuis localStorage s’il existe
                        const savedUsername = localStorage.getItem('username')
                        if (savedUsername) {
                            const usernameSpan = document.querySelector('main .username span')
                            if (usernameSpan) usernameSpan.textContent = savedUsername
                        }

                        setupUsernameEdit() // rebrancher le comportement
                    } else {
                        loadHTML('loader.html')
                    }
                })
            })

            // au chargement de la page : restaurer le username depuis localStorage s’il existe
            const savedUsername = localStorage.getItem('username')
            if (savedUsername) {
                const usernameSpan = document.querySelector('main .username span')
                if (usernameSpan) usernameSpan.textContent = savedUsername
            }

            // initialiser au chargement de la page
            setupUsernameEdit()
        })
    </script>
</head>
<body class="d-flex align-items-center justify-content-center">
    <div class="d-flex bg-white rounded-5 overflow-hidden" style="width: 884px; height: 725px;">
        <!-- sidebar -->
        <aside class="sidebar border-end p-3" style="width: 276px;">
            <ul class="nav flex-column gap-2 fs-5 fw-medium">
                <li role="button" class="active nav-item d-flex align-items-center gap-3 p-1 rounded-4">
                    <div class="bg-white rounded-4 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                        <img src="../icons/general.svg" alt="general" class="icon iconG"/>
                    </div>
                    <span>General</span>
                </li>
                <li role="button" class="nav-item d-flex align-items-center gap-3 p-1 rounded-4">
                    <div class="bg-white rounded-4 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                        <img src="../icons/Profile.svg" alt="profile" class="icon" />
                    </div>
                    <span>Profile</span>
                </li>
                <li role="button" class="nav-item d-flex align-items-center gap-3 p-1 rounded-4">
                    <div class="bg-white rounded-4 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                        <img src="../icons/Security.svg" alt="security" class="icon" />
                    </div>
                    <span>Security</span>
                </li>
                <li role="button" class="nav-item d-flex align-items-center gap-3 p-1 rounded-4">
                    <div class="bg-white rounded-4 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                        <img src="../icons/Notifications.svg" alt="notifications" class="icon" />
                    </div>
                    <span>Notifications</span>
                </li>
                <li role="button" class="nav-item d-flex align-items-center gap-3 p-1 rounded-4">
                    <div class="bg-white rounded-4 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                        <img src="../icons/Subscription.svg" alt="subscription" class="icon" />
                    </div>
                    <span>Subscription</span>
                </li>
            </ul>
        </aside>

        <!-- settings -->
        <main class="flex-grow-1 fs-6">
            <h2 class="m-4">General</h2>

            <hr>

            <!-- username -->
            <div class="username d-flex justify-content-between align-items-center m-4">
                <label class="username_label">Username</label>
                <div class="d-flex align-items-center">
                    <span class="me-2">sophie</span>
                    <button class="edit-btn" aria-label="Edit username">
                        <img src="../icons/edit.svg" alt="edit" />
                    </button>
                </div>
            </div>

            <hr>

            <!-- email -->
            <div class="d-flex justify-content-between align-items-center m-4">
                <label >Email</label>
                <span class="text-muted opacity-75">sophie@ui.live</span>
            </div>

            <hr>

            <!-- toggles -->
            <div class="d-flex justify-content-between align-items-center m-4">
                <label for="toggle-idea">Enable auto-prompt idea suggestion</label>
                <label class="switch">
                    <input type="checkbox" id="toggle-idea" checked/>
                    <span class="slider"></span>
                </label>
            </div>

            <hr>

            <div class="d-flex justify-content-between align-items-center m-4">
                <label for="toggle-video">Auto-play video on Explore</label>
                <label class="switch">
                    <input type="checkbox" id="toggle-video" checked/>
                    <span class="slider"></span>
                </label>
            </div>

            <hr>

            <div class="d-flex justify-content-between align-items-center m-4">
                <label for="toggle-publish">Publish to Explore</label>
                <label class="switch">
                    <input type="checkbox" id="toggle-publish" />
                    <span class="slider"></span>
                </label>
            </div>

            <hr>

            <!-- language -->
            <div class="d-flex justify-content-between align-items-center m-4">
                <label for="language-select">Language</label>
                <div class="custom-select border rounded-4 position-relative overflow-hidden">
                    <select id="language-select" class="fs-6">
                        <option>Auto detect</option>
                        <option>English</option>
                        <option>French</option>
                    </select>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
